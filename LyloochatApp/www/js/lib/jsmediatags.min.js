!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.jsmediatags=e()}}(function(){return function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[o]={exports:{}};t[o][0].call(c.exports,function(e){var r=t[o][1][e];return i(r?r:e)},c,c.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){},{}],2:[function(e,t,r){t.exports=XMLHttpRequest},{}],3:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=(e("./FlowTypes"),e("./ChunkedFileData")),u=e("./MediaFileReader"),l=function(e){function t(e){n(this,t);var r=i(this,Object.getPrototypeOf(t).call(this));return r._blob=e,r._fileData=new s,r}return a(t,e),o(t,[{key:"_init",value:function(e){this._size=this._blob.size,setTimeout(e.onSuccess,1)}},{key:"loadRange",value:function(e,t){var r=this,n=this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice,i=n.call(this._blob,e[0],e[1]+1),a=new FileReader;a.onloadend=function(n){var i=new Uint8Array(a.result);r._fileData.addData(e[0],i),t.onSuccess()},a.onerror=a.onabort=function(e){t.onError&&t.onError({type:"blob",info:a.error})},a.readAsArrayBuffer(i)}},{key:"getByteAt",value:function(e){return this._fileData.getByteAt(e)}}],[{key:"canReadFile",value:function(e){return"undefined"!=typeof Blob&&(e instanceof Blob||e instanceof File)}}]),t}(u);t.exports=l},{"./ChunkedFileData":4,"./FlowTypes":5,"./MediaFileReader":10}],4:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(e("./FlowTypes"),-1),o=function(){function e(){n(this,e),this._fileData=[]}return i(e,null,[{key:"NOT_FOUND",get:function(){return a}}]),i(e,[{key:"addData",value:function(e,t){var r=e+t.length-1,n=this._getChunkRange(e,r);if(n.startIx===a)this._fileData.splice(n.insertIx||0,0,{offset:e,data:t});else{var i=this._fileData[n.startIx],o=this._fileData[n.endIx],s=e>i.offset,u=r<o.offset+o.data.length-1,l={offset:Math.min(e,i.offset),data:t};if(s){var c=i.data.slice(0,e-i.offset);l.data=this._concatData(c,t)}if(u){var c=l.data.slice(0,o.offset-l.offset);l.data=this._concatData(c,o.data)}this._fileData.splice(n.startIx,n.endIx-n.startIx+1,l)}}},{key:"_concatData",value:function(e,t){if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(e)){var r=new e.constructor(e.length+t.length);return r.set(e,0),r.set(t,e.length),r}return e.concat(t)}},{key:"_getChunkRange",value:function(e,t){for(var r=a,n=a,i=0,o=0;o<this._fileData.length;o++,i=o){var s=this._fileData[o].offset,u=s+this._fileData[o].data.length;if(s-1>t)break;if(u+1>=e&&t>=s-1){r=o;break}}if(r===a)return{startIx:a,endIx:a,insertIx:i};for(var o=r;o<this._fileData.length;o++){var s=this._fileData[o].offset,u=s+this._fileData[o].data.length;if(t>=s-1&&(n=o),u+1>=t)break}return n===a&&(n=r),{startIx:r,endIx:n}}},{key:"hasDataRange",value:function(e,t){for(var r=0;r<this._fileData.length;r++){var n=this._fileData[r];if(t<n.offset)return!1;if(e>=n.offset&&t<n.offset+n.data.length)return!0}return!1}},{key:"getByteAt",value:function(e){for(var t,r=0;r<this._fileData.length;r++){var n=this._fileData[r].offset,i=n+this._fileData[r].data.length-1;if(e>=n&&i>=e){t=this._fileData[r];break}}if(t)return t.data[e-t.offset];throw new Error("Offset "+e+" hasn't been loaded yet.")}}]),e}();t.exports=o},{"./FlowTypes":5}],5:[function(e,t,r){"use strict";e("./MediaFileReader")},{"./MediaFileReader":10}],6:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=(e("./FlowTypes"),e("./MediaTagReader")),u=(e("./MediaFileReader"),function(e){function t(){return n(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),o(t,[{key:"_loadData",value:function(e,t){var r=e.getSize();e.loadRange([r-128,r-1],t)}},{key:"_parseData",value:function(e,t){var r=e.getSize()-128,n=e.getStringWithCharsetAt(r+3,30).toString(),i=e.getStringWithCharsetAt(r+33,30).toString(),a=e.getStringWithCharsetAt(r+63,30).toString(),o=e.getStringWithCharsetAt(r+93,4).toString(),s=e.getByteAt(r+97+28),u=e.getByteAt(r+97+29);if(0==s&&0!=u)var c="1.1",f=e.getStringWithCharsetAt(r+97,28).toString();else{var c="1.0",f=e.getStringWithCharsetAt(r+97,30).toString();u=0}var d=e.getByteAt(r+97+30);if(255>d)var g=l[d];else var g="";var h={type:"ID3",version:c,tags:{title:n,artist:i,album:a,year:o,comment:f,genre:g}};return u&&(h.tags.track=u),h}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:-128,length:128}}},{key:"canReadTagFormat",value:function(e){var t=String.fromCharCode.apply(String,e.slice(0,3));return"TAG"===t}}]),t}(s)),l=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","Acapella","Euro-House","Dance Hall"];t.exports=u},{"./FlowTypes":5,"./MediaFileReader":10,"./MediaTagReader":11}],7:[function(e,t,r){"use strict";function n(e){var t;switch(e){case 0:t="iso-8859-1";break;case 1:t="utf-16";break;case 2:t="utf-16be";break;case 3:t="utf-8"}return t}var i=(e("./FlowTypes"),e("./MediaFileReader"),{getFrameReaderFunction:function(e){return e in a?a[e]:"T"===e[0]?a["T*"]:null}}),a={};a.APIC=function(e,t,r,i,a){a=a||"3";var s=e,u=n(r.getByteAt(e));switch(a){case"2":var l=r.getStringAt(e+1,3);e+=4;break;case"3":case"4":var l=r.getStringWithCharsetAt(e+1,t-(e-s));e+=1+l.bytesReadCount}var c=r.getByteAt(e,1),f=o[c],d=r.getStringWithCharsetAt(e+1,t-(e-s),u);return e+=1+d.bytesReadCount,{format:l.toString(),type:f,description:d.toString(),data:r.getBytesAt(e,s+t-e)}},a.COMM=function(e,t,r,i,a){var o=e,s=n(r.getByteAt(e)),u=r.getStringAt(e+1,3),l=r.getStringWithCharsetAt(e+4,t-4,s);e+=4+l.bytesReadCount;var c=r.getStringWithCharsetAt(e,o+t-e,s);return{language:u,short_description:l.toString(),text:c.toString()}},a.COM=a.COMM,a.PIC=function(e,t,r,n,i){return a.APIC(e,t,r,n,"2")},a.PCNT=function(e,t,r,n,i){return r.getLongAt(e,!1)},a.CNT=a.PCNT,a["T*"]=function(e,t,r,i,a){var o=n(r.getByteAt(e));return r.getStringWithCharsetAt(e+1,t-1,o).toString()},a.TCON=function(e,t,r,n){var i=a["T*"].apply(this,arguments);return i.replace(/^\(\d+\)/,"")},a.TCO=a.TCON,a.USLT=function(e,t,r,i,a){var o=e,s=n(r.getByteAt(e)),u=r.getStringAt(e+1,3),l=r.getStringWithCharsetAt(e+4,t-4,s);e+=4+l.bytesReadCount;var c=r.getStringWithCharsetAt(e,o+t-e,s);return{language:u,descriptor:l.toString(),lyrics:c.toString()}},a.ULT=a.USLT;var o=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];t.exports=i},{"./FlowTypes":5,"./MediaFileReader":10}],8:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=(e("./FlowTypes"),e("./MediaTagReader")),u=(e("./MediaFileReader"),e("./ID3v2FrameReader")),l=function(e){function t(){return n(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),o(t,[{key:"_loadData",value:function(e,t){e.loadRange([6,9],{onSuccess:function(){e.loadRange([0,e.getSynchsafeInteger32At(6)],t)},onError:t.onError})}},{key:"_parseData",value:function(e,t){var r=0,n=e.getByteAt(r+3);if(n>4)return{type:"ID3",version:">2.4",tags:{}};var i=e.getByteAt(r+4),a=e.isBitSetAt(r+5,7),o=e.isBitSetAt(r+5,6),s=e.isBitSetAt(r+5,5),u=e.getSynchsafeInteger32At(r+6);if(r+=10,o){var l=e.getLongAt(r,!0);r+=l+4}var c={type:"ID3",version:"2."+n+"."+i,major:n,revision:i,flags:{unsynchronisation:a,extended_header:o,experimental_indicator:s,footer_present:!1},size:u,tags:{}};if(a)var d={};else var d=this._readFrames(r,u-10,e,c,t);for(var g in f)if(f.hasOwnProperty(g)){var h=this._getFrameData(d,f[g]);h&&(c.tags[g]=h)}for(var p in d)d.hasOwnProperty(p)&&(c.tags[p]=d[p]);return c}},{key:"_readFrames",value:function(e,t,r,n,i){var a={};for(i&&(i=this._expandShortcutTags(i));t>e;){var o=this._readFrameHeader(r,e,n),s=o.id;if(0===o.size)break;if(!s)break;var l=o.flags,c=o.size,f=e+o.headerSize;if(e+=o.headerSize+o.size,!(i&&-1===i.indexOf(s)||l&&l.format.unsynchronisation)){l&&l.format.data_length_indicator&&(f+=4,c-=4);var d=u.getFrameReaderFunction(s),g=d?d(f,c,r,l):null,h=this._getFrameDescription(s),p={id:s,size:c,description:h,data:g};s in a?(a[s].id&&(a[s]=[a[s]]),a[s].push(p)):a[s]=p}}return a}},{key:"_readFrameHeader",value:function(e,t,r){var n=r.major,i=null;switch(n){case 2:var a=e.getStringAt(t,3),o=e.getInteger24At(t+3,!0),s=6;break;case 3:var a=e.getStringAt(t,4),o=e.getLongAt(t+4,!0),s=10;break;case 4:var a=e.getStringAt(t,4),o=e.getSynchsafeInteger32At(t+4),s=10}return a&&n>2&&(i=this._readFrameFlags(e,t+8)),{id:a,size:o,headerSize:s,flags:i}}},{key:"_readFrameFlags",value:function(e,t){return{message:{tag_alter_preservation:e.isBitSetAt(t,6),file_alter_preservation:e.isBitSetAt(t,5),read_only:e.isBitSetAt(t,4)},format:{grouping_identity:e.isBitSetAt(t+1,7),compression:e.isBitSetAt(t+1,3),encryption:e.isBitSetAt(t+1,2),unsynchronisation:e.isBitSetAt(t+1,1),data_length_indicator:e.isBitSetAt(t+1,0)}}}},{key:"_getFrameData",value:function(e,t){for(var r,n=0;r=t[n];n++)if(r in e)return e[r].data}},{key:"_getFrameDescription",value:function(e){return e in c?c[e]:"Unknown"}},{key:"_expandShortcutTags",value:function(e){for(var t,r=[],n=0;t=e[n];n++)r=r.concat(f[t]||[t]);return r}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:10}}},{key:"canReadTagFormat",value:function(e){var t=String.fromCharCode.apply(String,e.slice(0,3));return"ID3"===t}}]),t}(s),c={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},f={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};t.exports=l},{"./FlowTypes":5,"./ID3v2FrameReader":7,"./MediaFileReader":10,"./MediaTagReader":11}],9:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=(e("./FlowTypes"),e("./MediaTagReader")),u=(e("./MediaFileReader"),function(e){function t(){return n(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),o(t,[{key:"_loadData",value:function(e,t){var r=this;e.loadRange([0,16],{onSuccess:function(){r._loadAtom(e,0,"",t)},onError:t.onError})}},{key:"_loadAtom",value:function(e,t,r,n){if(t>=e.getSize())return void n.onSuccess();var i=this,a=e.getLongAt(t,!0);if(0==a||isNaN(a))return void n.onSuccess();var o=e.getStringAt(t+4,4);if(this._isContainerAtom(o)){"meta"==o&&(t+=4);var s=(r?r+".":"")+o;"moov.udta.meta.ilst"===s?e.loadRange([t,t+a],n):e.loadRange([t+8,t+8+8],{onSuccess:function(){i._loadAtom(e,t+8,s,n)},onError:n.onError})}else e.loadRange([t+a,t+a+8],{onSuccess:function(){i._loadAtom(e,t+a,r,n)},onError:n.onError})}},{key:"_isContainerAtom",value:function(e){return["moov","udta","meta","ilst"].indexOf(e)>=0}},{key:"_canReadAtom",value:function(e){return"----"!==e}},{key:"_parseData",value:function(e,t){var r={};this._readAtom(r,e,0,e.getSize(),t);for(var n in f)if(f.hasOwnProperty(n)){var i=r[f[n]];i&&("track"===n?r[n]=i.data.track:r[n]=i.data)}return{type:"MP4",ftyp:e.getStringAt(8,4),version:e.getLongAt(12,!0),tags:r}}},{key:"_readAtom",value:function(e,t,r,n,i,a,o){o=void 0===o?"":o+"  ";for(var s=r;r+n>s;){var u=t.getLongAt(s,!0);if(0==u)return;var l=t.getStringAt(s+4,4);if(this._isContainerAtom(l)){"meta"==l&&(s+=4);var c=(a?a+".":"")+l;return void this._readAtom(e,t,s+8,u-8,i,c,o)}(!i||i.indexOf(l)>=0)&&"moov.udta.meta.ilst"===a&&this._canReadAtom(l)&&(e[l]=this._readMetadataAtom(t,s)),s+=u}}},{key:"_readMetadataAtom",value:function(e,t){var r,n=16,i=e.getLongAt(t,!0),a=e.getStringAt(t+4,4),o=e.getInteger24At(t+n+1,!0),s=l[o];if("trkn"==a)r={track:e.getByteAt(t+n+11),total:e.getByteAt(t+n+13)};else{var r,u=n+4+4,f=t+u,d=i-u;switch(s){case"text":r=e.getStringWithCharsetAt(f,d,"utf-8").toString();break;case"uint8":r=e.getShortAt(f,!1);break;case"jpeg":case"png":r={format:"image/"+s,data:e.getBytesAt(f,d)}}}return{id:a,size:i,description:c[a]||"Unknown",data:r}}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:16}}},{key:"canReadTagFormat",value:function(e){var t=String.fromCharCode.apply(String,e.slice(4,8));return"ftyp"===t}}]),t}(s)),l={0:"uint8",1:"text",13:"jpeg",14:"png",21:"uint8"},c={"©alb":"Album","©ART":"Artist",aART:"Album Artist","©day":"Release Date","©nam":"Title","©gen":"Genre",gnre:"Genre",trkn:"Track Number","©wrt":"Composer","©too":"Encoding Tool","©enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","©grp":"Grouping",keyw:"Keywords","©lyr":"Lyrics","©cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",tven:"TV Episode ID",tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code"},f={title:"©nam",artist:"©ART",album:"©alb",year:"©day",comment:"©cmt",track:"trkn",genre:"©gen",picture:"covr",lyrics:"©lyr"};t.exports=u},{"./FlowTypes":5,"./MediaFileReader":10,"./MediaTagReader":11}],10:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(e("./StringUtils"),e("./FlowTypes"),e("./StringUtils")),o=function(){function e(){n(this,e),this._isInitialized=!1,this._size=0}return i(e,[{key:"init",value:function(e){var t=this;return this._isInitialized?void setTimeout(e.onSuccess,1):this._init({onSuccess:function(){t._isInitialized=!0,e.onSuccess()},onError:e.onError})}},{key:"_init",value:function(e){throw new Error("Must implement init function")}},{key:"loadRange",value:function(e,t){throw new Error("Must implement loadRange function")}},{key:"getSize",value:function(){if(!this._isInitialized)throw new Error("init() must be called first.");return this._size}},{key:"getByteAt",value:function(e){throw new Error("Must implement getByteAt function")}},{key:"getBytesAt",value:function(e,t){for(var r=new Array(t),n=0;t>n;n++)r[n]=this.getByteAt(e+n);return r}},{key:"isBitSetAt",value:function(e,t){var r=this.getByteAt(e);return 0!=(r&1<<t)}},{key:"getSByteAt",value:function(e){var t=this.getByteAt(e);return t>127?t-256:t}},{key:"getShortAt",value:function(e,t){var r=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);return 0>r&&(r+=65536),r}},{key:"getSShortAt",value:function(e,t){var r=this.getShortAt(e,t);return r>32767?r-65536:r}},{key:"getLongAt",value:function(e,t){var r=this.getByteAt(e),n=this.getByteAt(e+1),i=this.getByteAt(e+2),a=this.getByteAt(e+3),o=t?(((r<<8)+n<<8)+i<<8)+a:(((a<<8)+i<<8)+n<<8)+r;return 0>o&&(o+=4294967296),o}},{key:"getSLongAt",value:function(e,t){var r=this.getLongAt(e,t);return r>2147483647?r-4294967296:r}},{key:"getInteger24At",value:function(e,t){var r=this.getByteAt(e),n=this.getByteAt(e+1),i=this.getByteAt(e+2),a=t?((r<<8)+n<<8)+i:((i<<8)+n<<8)+r;return 0>a&&(a+=16777216),a}},{key:"getStringAt",value:function(e,t){for(var r=[],n=e,i=0;e+t>n;n++,i++)r[i]=String.fromCharCode(this.getByteAt(n));return r.join("")}},{key:"getStringWithCharsetAt",value:function(e,t,r){var n,i=this.getBytesAt(e,t);switch((r||"").toLowerCase()){case"utf-16":case"utf-16le":case"utf-16be":n=a.readUTF16String(i,"utf-16be"===r);break;case"utf-8":n=a.readUTF8String(i);break;default:n=a.readNullTerminatedString(i)}return n}},{key:"getCharAt",value:function(e){return String.fromCharCode(this.getByteAt(e))}},{key:"getSynchsafeInteger32At",value:function(e){var t=this.getByteAt(e),r=this.getByteAt(e+1),n=this.getByteAt(e+2),i=this.getByteAt(e+3),a=127&i|(127&n)<<7|(127&r)<<14|(127&t)<<21;return a}}],[{key:"canReadFile",value:function(e){throw new Error("Must implement canReadFile function")}}]),e}();t.exports=o},{"./FlowTypes":5,"./StringUtils":12}],11:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(e("./FlowTypes"),e("./MediaFileReader"),function(){function e(t){n(this,e),this._mediaFileReader=t,this._tags=null}return i(e,[{key:"setTagsToRead",value:function(e){return this._tags=e,this}},{key:"read",value:function(e){var t=this;this._mediaFileReader.init({onSuccess:function(){t._loadData(t._mediaFileReader,{onSuccess:function(){var r=t._parseData(t._mediaFileReader,t._tags);e.onSuccess(r)},onError:e.onError})},onError:e.onError})}},{key:"_loadData",value:function(e,t){throw new Error("Must implement _loadData function")}},{key:"_parseData",value:function(e,t){throw new Error("Must implement _parseData function")}}],[{key:"getTagIdentifierByteRange",value:function(){throw new Error("Must implement")}},{key:"canReadTagFormat",value:function(e){throw new Error("Must implement")}}]),e}());t.exports=a},{"./FlowTypes":5,"./MediaFileReader":10}],12:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(t,r){n(this,e),this._value=t,this.bytesReadCount=r,this.length=t.length}return i(e,[{key:"toString",value:function(){return this._value}}]),e}(),o={readUTF16String:function(e,t,r){var n=0,i=1,o=0;r=Math.min(r||e.length,e.length),254==e[0]&&255==e[1]?(t=!0,n=2):255==e[0]&&254==e[1]&&(t=!1,n=2),t&&(i=0,o=1);for(var s=[],u=0;r>n;u++){var l=e[n+i],c=e[n+o],f=(l<<8)+c;if(n+=2,0==f)break;if(216>l||l>=224)s[u]=String.fromCharCode(f);else{var d=e[n+i],g=e[n+o],h=(d<<8)+g;n+=2,s[u]=String.fromCharCode(f,h)}}return new a(s.join(""),n)},readUTF8String:function(e,t){var r=0;t=Math.min(t||e.length,e.length),239==e[0]&&187==e[1]&&191==e[2]&&(r=3);for(var n=[],i=0;t>r;i++){var o=e[r++];if(0==o)break;if(128>o)n[i]=String.fromCharCode(o);else if(o>=194&&224>o){var s=e[r++];n[i]=String.fromCharCode(((31&o)<<6)+(63&s))}else if(o>=224&&240>o){var s=e[r++],u=e[r++];n[i]=String.fromCharCode(((255&o)<<12)+((63&s)<<6)+(63&u))}else if(o>=240&&245>o){var s=e[r++],u=e[r++],l=e[r++],c=((7&o)<<18)+((63&s)<<12)+((63&u)<<6)+(63&l)-65536;n[i]=String.fromCharCode((c>>10)+55296,(1023&c)+56320)}}return new a(n.join(""),r)},readNullTerminatedString:function(e,t){var r=[];t=t||e.length;for(var n=0;t>n;){var i=e[n++];if(0==i)break;r[n-1]=String.fromCharCode(i)}return new a(r.join(""),n)}};t.exports=o},{}],13:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=(e("./FlowTypes"),e("./ChunkedFileData")),u=e("./MediaFileReader"),l=1024,c=function(t){function r(e){n(this,r);var t=i(this,Object.getPrototypeOf(r).call(this));return t._url=e,t._fileData=new s,t}return a(r,t),o(r,[{key:"_init",value:function(e){var t=this;this._makeXHRRequest("HEAD",null,{onSuccess:function(r){t._size=parseInt(r.getResponseHeader("Content-Length"),10),e.onSuccess()},onError:e.onError})}},{key:"loadRange",value:function(e,t){var r=this;return r._fileData.hasDataRange(e[0],e[1])?void setTimeout(t.onSuccess,1):(e=this._roundRangeToChunkMultiple(e),void this._makeXHRRequest("GET",e,{onSuccess:function(n){var i=n.responseBody||n.responseText;r._fileData.addData(e[0],i),t.onSuccess()},onError:t.onError}))}},{key:"_roundRangeToChunkMultiple",value:function(e){var t=e[1]-e[0]+1,r=Math.ceil(t/l)*l;return[e[0],e[0]+r-1]}},{key:"_makeXHRRequest",value:function(e,t,r){var n=this._createXHRObject(),i=function(){200===n.status||206===n.status?r.onSuccess(n):r.onError&&r.onError({type:"xhr",info:"Unexpected HTTP status "+n.status+".",xhr:n}),n=null};"undefined"!=typeof n.onload?(n.onload=i,n.onerror=function(){r.onError&&r.onError({type:"xhr",info:"Generic XHR error, check xhr object.",xhr:n})}):n.onreadystatechange=function(){4===n.readyState&&i()},n.open(e,this._url),n.overrideMimeType("text/plain; charset=x-user-defined"),t&&n.setRequestHeader("Range","bytes="+t[0]+"-"+t[1]),n.setRequestHeader("If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT"),n.send(null)}},{key:"getByteAt",value:function(e){var t=this._fileData.getByteAt(e);return 255&t.charCodeAt(0)}},{key:"_createXHRObject",value:function(){if("undefined"==typeof window)return new(e("xhr2").XMLHttpRequest);if(window.XMLHttpRequest)return new window.XMLHttpRequest;throw new Error("XMLHttpRequest is not supported")}}],[{key:"canReadFile",value:function(e){return"string"==typeof e&&/^[a-z]+:\/\//i.test(e)}}]),r}(u);t.exports=c},{"./ChunkedFileData":4,"./FlowTypes":5,"./MediaFileReader":10,xhr2:2}],14:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){new h(e).read(t)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=(e("./FlowTypes"),e("./MediaFileReader"),e("./NodeFileReader")),s=e("./XhrFileReader"),u=e("./BlobFileReader"),l=(e("./MediaTagReader"),e("./ID3v1TagReader")),c=e("./ID3v2TagReader"),f=e("./MP4TagReader"),d=[],g=[],h=function(){
function e(t){n(this,e),this._file=t}return a(e,[{key:"setTagsToRead",value:function(e){return this._tagsToRead=e,this}},{key:"setFileReader",value:function(e){return this._fileReader=e,this}},{key:"setTagReader",value:function(e){return this._tagReader=e,this}},{key:"read",value:function(e){var t=this._getFileReader(),r=new t(this._file),n=this;r.init({onSuccess:function(){n._getTagReader(r,{onSuccess:function(t){new t(r).setTagsToRead(n._tagsToRead).read(e)},onError:e.onError})},onError:e.onError})}},{key:"_getFileReader",value:function(){return this._fileReader?this._fileReader:this._findFileReader()}},{key:"_findFileReader",value:function(){for(var e=0;e<d.length;e++)if(d[e].canReadFile(this._file))return d[e];throw new Error("No suitable file reader found for ",this._file)}},{key:"_getTagReader",value:function(e,t){if(this._tagReader){var r=this._tagReader;setTimeout(function(){t.onSuccess(r)},1)}else this._findTagReader(e,t)}},{key:"_findTagReader",value:function(e,t){for(var r=[],n=[],i=e.getSize(),a=0;a<g.length;a++){var o=g[a].getTagIdentifierByteRange();o.offset>=0&&o.offset<i/2||o.offset<0&&o.offset<-i/2?r.push(g[a]):n.push(g[a])}var s=!1,u={onSuccess:function(){if(!s)return void(s=!0);for(var r=0;r<g.length;r++){var n=g[r].getTagIdentifierByteRange(),a=e.getBytesAt(n.offset>=0?n.offset:n.offset+i,n.length);if(g[r].canReadTagFormat(a))return void t.onSuccess(g[r])}t.onError&&t.onError({type:"tagFormat",info:"No suitable tag reader found"})},onError:t.onError};this._loadTagIdentifierRanges(e,r,u),this._loadTagIdentifierRanges(e,n,u)}},{key:"_loadTagIdentifierRanges",value:function(e,t,r){if(0===t.length)return void setTimeout(r.onSuccess,1);for(var n=[Number.MAX_VALUE,0],i=e.getSize(),a=0;a<t.length;a++){var o=t[a].getTagIdentifierByteRange(),s=o.offset>=0?o.offset:o.offset+i,u=s+o.length-1;n[0]=Math.min(s,n[0]),n[1]=Math.max(u,n[1])}e.loadRange(n,r)}}]),e}(),p=function(){function e(){n(this,e)}return a(e,null,[{key:"addFileReader",value:function(e){return d.push(e),this}},{key:"addTagReader",value:function(e){return g.push(e),this}},{key:"removeTagReader",value:function(e){var t=g.indexOf(e);return t>=0&&g.splice(t,1),this}}]),e}();p.addFileReader(s).addFileReader(u).addTagReader(c).addTagReader(l).addTagReader(f),"undefined"!=typeof process&&p.addFileReader(o),t.exports={read:i,Reader:h,Config:p}},{"./BlobFileReader":3,"./FlowTypes":5,"./ID3v1TagReader":6,"./ID3v2TagReader":8,"./MP4TagReader":9,"./MediaFileReader":10,"./MediaTagReader":11,"./NodeFileReader":1,"./XhrFileReader":13}]},{},[14])(14)});
