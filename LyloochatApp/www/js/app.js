function App(t){function e(){this.model.options={},this.model.options.prefix=""}this.loaded=!1,this.views={},this.model={},this.deviceHandler=t,this.soundLibrary=void 0,Handlebars.registerPartial("widget_badge_button",Lyloochat.templates.widget_badge_button),Handlebars.registerPartial("widget_text_button",Lyloochat.templates.widget_text_button),Handlebars.registerPartial("widget_floating_button",Lyloochat.templates.widget_floating_button),this.initialisation=function(){console.log("initialisation"),$.event.special.tap.emitTapOnTaphold=!1;var n=this;showLoadingPanel("Chargement des cartes..."),this.model.listCards=new ListCards,t.loadCards(this.model.listCards,function(){e.call(n),n.views.menu=new AppMenu(n),n.views.grid=new AppGrid(n),n.loaded=!0,hideLoadingPanel()}),window.onerror=function(t,e,n,i,s){console.error(t),showErrorPanel(t)}},this.getSoundLibrary=function(e){if(void 0!==i)e(i);else{var n=this,i=new SoundLibrary;showLoadingPanel("Chargement des sons..."),t.loadSounds(i,function(){hideLoadingPanel(),n.soundLibrary=i,e(n.soundLibrary)})}}}function showMaskPanel(t){$.inner_showMaskPanel(this,!0,t)}function hideMaskPanel(){$.inner_hideMaskPanel(this)}function showErrorPanel(t){$.inner_showErrorPanel(this,t,hideErrorPanel)}function hideErrorPanel(){$.inner_hideErrorPanel(this)}function showLoadingPanel(t){$.inner_showLoadingPanel(this,t,hideLoadingPanel)}function hideLoadingPanel(){$.inner_hideLoadingPanel(this)}function AppGrid(t){function e(){var e=document.getElementById("grid-cards");for(i=0;i<t.model.listCards.length();i++){var a,o=t.model.listCards.getCard(i);if(o instanceof Card_Text?a=new Widget_Card_Text(this,o):o instanceof Card_Drawing?a=new Widget_Card_Drawing(this,o):o instanceof Card_Sound&&(a=new Widget_Card_Sound(this,o)),"undefined"==typeof a)throw"Type de carte non supporté encore.";a.render(e)}n(),s()}function n(){var t,e,n,i,s;$(".ripple").on("tap",function(a){var o=phonegapHandler.app;o.loaded&&(t=$(this),0===t.find(".ink").length&&t.prepend("<span class='ink'></span>"),e=t.find(".ink"),e.removeClass("animate"),e.height()||e.width()||(n=Math.max(t.outerWidth(),t.outerHeight()),e.css({height:n,width:n})),i=a.pageX-t.offset().left-e.width()/2,s=a.pageY-t.offset().top-e.height()/2,e.css({top:s+"px",left:i+"px"}).addClass("animate"))})}function s(){$(".card-text").on("taphold",function(t){var e=phonegapHandler.app;if(e.loaded){void 0===e.views.cardConfigurator&&(e.views.cardConfigurator=new CardConfigurator);var n=$(this);e.views.cardConfigurator.onClick(n,t)}})}this.app=t,this.busy=!1,e()}function AppMenu(t){function e(){var t=document.getElementById("appmenu"),e={name:"Lyloochat",icon:"check",links:[{longCode:"Afficher un texte",code:"Texte",icon:"keyboard"},{longCode:"Jouer un son",code:"Son",icon:"sound"},{longCode:"Dessiner quelquechose",code:"Dessin",icon:"pen"},{longCode:"Changer les options",code:"Options",icon:"settings"}]};t.innerHTML=Lyloochat.templates.widget_menus(e)}function n(){var t=this,e=$(".app-menu-type-keyboard");e.on("tap",function(n){s.call(t,e)});var n=$(".app-menu-type-sound");n.on("tap",function(e){i.call(t,n)});var d=$("app-menu-type-pen");d.on("tap",function(e){a.call(t,d)});var r=$(".app-menu-type-settings");r.on("tap",function(e){o.call(t,r)})}function i(t){void 0===this.menu_sound&&(this.menu_sound=new AppMenu_Sound(this)),d.call(this,this.menu_sound,t)}function s(t){void 0===this.menu_text,d.call(this,this.menu_text,t)}function a(t){void 0===this.menu_drawing,d.call(this,this.menu_drawing,t)}function o(t){void 0===this.menu_options,d.call(this,this.menu_options,t)}function d(t,e){t===this.selected_menu?(t.hide(),e.removeClass("selected"),this.selected_menu=void 0,this.$selected_menu_elem=void 0,r.call(this)):(void 0!==this.selected_menu&&(this.selected_menu.hide(),this.$selected_menu_elem.removeClass("selected"),this.$selected_menu_elem=void 0,r.call(this)),this.selected_menu=t,t.show(),this.$selected_menu_elem=e,e.addClass("selected"),l.call(this))}function r(){var t=$(".app-content");t.removeClass("freeze-scroll")}function l(){var t=$(".app-content");t.addClass("freeze-scroll")}this.app=t,this.menu_text=void 0,this.menu_sound=void 0,this.menu_drawing=void 0,this.menu_options=void 0,this.selected_menu=void 0,this.$selected_menu_elem=void 0,e.call(this),n.call(this)}function CardConfigurator(){function t(){this.busy=!1,this.elementSelect=void 0,hideMaskPanel()}function e(){var t=$(".mask");t.html("<div class='cardConfigurator-button-ctn'></div>");var e=t.find(".cardConfigurator-button-ctn"),s={"class":"butt-edit",title:"Editer l'item",icon:"edit",code:"Editer"};e.html(Lyloochat.templates.widget_badge_button(s));var a=$(".badge-button.butt-edit");a.on("click",i),s={"class":"butt-delete",title:"Supprimer l'item",icon:"delete",code:"Supprimer"},e.append(Lyloochat.templates.widget_badge_button(s));var o=$(".badge-button.butt-delete");o.on("click",n)}function n(t){console.log("_on_deleteItem"),t.stopPropagation()}function i(t){console.log("_on_editItem"),t.stopPropagation()}this.onClick=function(n,i){if(!this.busy){this.busy=!0,this.elementSelect=n,showMaskPanel.call(this,t);$(window).width();e.call(this)}}}function Card(t,e){this.id=t,this.code=e}function Card_Drawing(t,e,n){this.svg=n,Card.apply(this,[t,e])}function Card_Sound(t,e,n){this.filepath=n,Card.apply(this,[t,e])}function Card_Text(t,e,n){this.label=n,Card.apply(this,[t,e])}function ListCards(){this.cards=[],this.addCard=function(t){this.cards.push(t)},this.length=function(){return this.cards.length},this.getCard=function(t){return this.cards[t]},this.replaceCard=function(t,e){this.cards[t]=e}}function Sound(t,e,n,i){function s(t,e){var n=e-t.toString().length+1;return Array(+(n>0&&n)).join("0")+t}this.library=void 0,this.name=t,this.author=e,this.filepath=n,this.duration=i,this.getDurationStr=function(){var t=new Date(1e3*i),e=t.getMinutes();e=s.call(this,e,2);var n=t.getSeconds();return n=s.call(this,n,2),e+":"+n},this.play=function(t){this.library.playSound(this,t)},this.stop=function(t){this.library.stopSound(this,t)}}function SoundLibrary(){this.recents_played=new SoundList(this),this.all_sounds=new SoundList(this),this.ready=!1,this.searchSounds=function(t,e){return new SoundList(this)},this.playSound=function(t,e){this.ready=!1},this.stopSound=function(t,e){e()},this.onSoundsLoaded=function(){this.ready=!0}}function SoundList(t){this.library=t,this.list=[],this.size=function(){return this.list.length},this.get=function(t){return this.list[t]},this.add=function(t){this.list.push(t),t.library=this.library}}function Widget_Card(t,e){function n(){var e=this,n=$(this.elem_card).find(".container");n.on("tap",function(){t.busy||(t.busy=!0,setTimeout(function(){e.onCardThumbnailClick(),t.busy=!1},200))})}this.appGrid=t,this.card=e,this.elem_card=void 0,this.fullscreen_card=void 0,this.getCardThumbailContent=function(){return showErrorPanel("Shouldn't be there you naughty boy !"),""},this.onCardThumbnailClick=function(){showErrorPanel("Shouldn't be there you naughty boy !")},this.render=function(t){$(t).append(this.getCardThumbailContent.call(this));var e=t.lastElementChild;return this.elem_card=e,n.call(this),""}}function Widget_Card_Drawing(t,e){Widget_Card.apply(this,[t,e]),this.getCardThumbailContent=function(){var t={cardNumber:e.id,title:e.code};return Lyloochat.templates.widget_card_text(t)},this.onCardThumbnailClick=function(){showErrorPanel("Click Widget_Card_Drawing")}}function Widget_Card_Sound(t,e){Widget_Card.apply(this,[t,e]),this.getCardThumbailContent=function(){var t={cardNumber:e.id,title:e.code};return Lyloochat.templates.widget_card_text(t)},this.onCardThumbnailClick=function(){showErrorPanel("Click Widget_Card_Sound")}}function Widget_Card_Text(t,e){Widget_Card.apply(this,[t,e]),this.getCardThumbailContent=function(){var t={cardNumber:e.id,title:e.code};return Lyloochat.templates.widget_card_text(t)},this.onCardThumbnailClick=function(){this.displayed_screen_card=new Screen_Card_Text(this),this.displayed_screen_card.display()}}function Screen_Card(t){this.widget_card=t,this.display=function(){showErrorPanel("Shouldn't be there you naughty boy !")}}function Screen_Card_Drawing(t){Screen_Card.apply(this,[t])}function Screen_Card_Sound(t){Screen_Card.apply(this,[t])}function Screen_Card_Text(t){Screen_Card.apply(this,[t]),this.display=function(){var e=$("body"),n={label:t.card.label},i=Lyloochat.templates.screen_display_card_text(n);e.append(i);var s=e.children().last(),a=s.find(".container");a.boxfit(),$(window).resize(function(){s.attr("style",""),a.attr("style",""),a.boxfit()});var o=s.find(".card-fs-butt-ok");o.on("click",function(t){$(s).remove()})}}function AppMenu_Impl(t){this.appMenu=t,this.displayed=!1,this.show=function(){showErrorPanel("Shouldn't be there you naughty boy !")},this.hide=function(){showErrorPanel("Shouldn't be there you naughty boy !")}}function AppMenu_Sound(t){function e(t,e){var n=new Widget_Sound(this,t,e);n.insert()}function n(t){var n=$(".app-content");if(""!==t){var s=this.soundLibrary.searchSounds(this.appMenu.app.model.options.prefix,t),a=n.find(".results-list");for(a.empty(),i=0;i<s.size();i++){var o=s.get(i);e.call(this,a,o)}a.removeClass("hidden");var d=n.find(".results-rule");d.removeClass("hidden");var r=n.find(".results-title");r.removeClass("hidden");var l=n.find(".recents-list");l.addClass("hidden"),d=n.find(".recents-rule"),d.addClass("hidden"),r=n.find(".recents-title"),r.addClass("hidden")}else{var h=n.find(".recents-list");h.removeClass("hidden");var u=n.find(".recents-rule");u.removeClass("hidden");var c=n.find(".recents-title");c.removeClass("hidden"),h=n.find(".results-list"),h.addClass("hidden"),u=n.find(".results-rule"),u.addClass("hidden"),c=n.find(".results-title"),c.addClass("hidden")}}function s(){var t=$(".app-content"),s=t.find(".recents-list");for(i=0;i<this.soundLibrary.recents_played.size();i++){var a=this.soundLibrary.recents_played.get(i);e.call(this,s,a)}var o=this,d=t.find(".app-menu-expanded .search-input");d.on("keypress",function(t){var e=t.keyCode?t.keyCode:t.which;13==e&&(t.preventDefault(),console.log("Son cherché : "+d.val()),n.call(o,d.val()),d.blur())})}AppMenu_Impl.apply(this,[t]),this.soundLibrary=void 0;var a=this;this.termSearched="",t.app.getSoundLibrary(function(t){a.soundLibrary=t,a.displayed&&s.call(a)}),this.playingWidgetSound=void 0,this.show=function(){var t={},e=Lyloochat.templates.menu_sound(t),n=$(".app-content");n.append(e),this.displayed=!0,void 0!==this.soundLibrary&&s.call(this)},this.hide=function(){var t=$(".app-content .app-menu-expanded");t.remove(),this.displayed=!1},this.onPlay=function(t){void 0!==this.playingWidgetSound&&this.playingWidgetSound.playing&&this.playingWidgetSound.stop(),this.playingWidgetSound=t}}function Widget_Sound(t,e,n){function i(){this.playing=!1,this.$elem_sound.removeClass("selected");var t=this.$elem_sound.find(".sound-icon");t.removeClass("icon-pause"),t.addClass("icon-play")}this.$elem_parent=e,this.$elem_sound=void 0,this.sound=n,this.appMenuSound=t,this.playing=!1,this.insert=function(){var t={name:this.sound.name,durationStr:this.sound.getDurationStr()},e=Lyloochat.templates.widget_sound(t);this.$elem_parent.append(e),this.$elem_sound=this.$elem_parent.children().last();var n=this;this.$elem_sound.on("tap",function(t){n.playing?n.stop():n.play()})},this.play=function(){this.playing=!0,this.appMenuSound.onPlay(this);var t=this;this.sound.play(function(){i.call(t)}),this.$elem_sound.addClass("selected");var e=this.$elem_sound.find(".sound-icon");e.removeClass("icon-play"),e.addClass("icon-pause")},this.stop=function(){var t=this;this.sound.stop(function(){i.call(t)})}}!function(t,e){e.inner_showMaskPanel=function(t,n,i){var s=e(".mask");s.html(""),s.addClass("visible"),n&&s.on("click",function(e){i.call(t)})},e.inner_hideMaskPanel=function(t){var n=e(".mask");n.html(""),n.removeClass("visible"),n.off("click")},e.inner_showErrorPanel=function(t,n){e.inner_showMaskPanel(this,!0,hideErrorPanel);var i=e(".mask"),s={type:"error",header:{icon:"sad",message:"Onoz !"},messages:[n],footer:{buttons:["ok"]}};i.html(Lyloochat.templates.widget_dialog(s))},e.inner_hideErrorPanel=function(t){e.inner_hideMaskPanel(t)},e.inner_showLoadingPanel=function(t,n){e.inner_showMaskPanel(this,!1,hideLoadingPanel);var i=e(".mask"),s={type:"loading",messages:[n]};i.html(Lyloochat.templates.widget_dialog(s))},e.inner_hideLoadingPanel=function(t){e.inner_hideMaskPanel(t)}}(window,jQuery),Handlebars.registerHelper("if_eq",function(t,e,n){return t===e?n.fn(this):n.inverse(this)});